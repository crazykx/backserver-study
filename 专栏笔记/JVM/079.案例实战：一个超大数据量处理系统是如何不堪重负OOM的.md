---
title: 超大数据量处理系统OOM
tags:
  - jvm
  - OOM
categories:
  - jvm
  - 实战笔记
keywords: 
date: 2019-09-19
updated: 2019-10-31
description: 
top_img:

---



超大数据量处理系统的案例

一个非常复杂的PB级数据计算系统同时处理的数据量也特别大，因为他处理的数据量实在是很大，负载也过高，所以除了GC问题以外，还有OOM问题。



简单来说，就是不停的从数据存储中加载大量的数据到内存里来进行复杂的计算，然后将结果发送至kafka, 当发生了Kafka的短暂临时故障，也因此导致了系统无法将计算后的数据推送给Kafka



然后所有数据全部驻留在内存里等待，并且还在不停的加载数据到内存里来计算。



内存里的数据必然越来越多，每次Eden区塞满之后，大量存活的对象必须转入老年代中，而且这些老年代里的对象还是无法释放掉的。



老年代最终一定会满，而且最终一定会有一次Eden区满之后，一大批对象要转移到老年代，结果老年代即使Full gc之后还是没有空间可以放的下，最终就会导致内存溢出。然后线上收到报警说内存溢出。



最后这个系统全线崩溃，无法正常运行。



对这个问题进行修复：



临时取消了Kafka故障下的重试机制，一旦Kafka故障，直接丢弃掉本地计算结果，允许释放大量数据占用的内存。后续的话，将这个机制优化为一旦Kafka故障，则计算结果写本地磁盘，允许内存中的数据被回收。

