1. 哨兵介绍

   1. sentinal重要功能

      1. 集群监控: 负责监控 Redis master和 slave 进程是否正常工作
      2. 消息通知: 如果某个Redis实例有故障, 那么哨兵会负责发送消息作为报警通知给管理员
      3. 故障转移: 如果 master node 挂掉了, 会自动转移到 slave  node 上
      4. 配置中心: 如果故障转移发生了,通知 client 客户端新的 master 地址

   2. 哨兵也是分布式的, 作为一个集群去运行

      1. 故障转移时, 判断一个 master node 是宕机了, 需要大部分的哨兵都同意才行, 涉及到了分布式选举的问题
      2. 即使部分哨兵节点挂掉了, 哨兵集群还是能正常工作的, 因为如果一个作为高可用机制重要组成部分的故障转移系统本身是单点的,那就很坑爹了

   3. Sentinal2 版本重写了很多代码, 故障转移机制和算法变得更加健壮和简单

      

2. 哨兵的核心知识

   1. 哨兵至少需要 3 个实例, 来保证自己的健壮性

   2. 哨兵 + Redis 主从的部署架构,是不会保证数据领丢失的, 只能保证  Redis集群的高可用性

   3. 对于哨兵 + Redis主从这种复杂的部署架构, 尽量在测试及生产环境进行充足的测试及演练

      

3. 为什么 Redis 哨兵集群只有 2 个节点无法工作

   1. 哨兵节点必须 2 个以上节点

   2. 如果只有两个哨兵, 且其中一个与 master node 在一台机器上

      1. 此时若 master 机器挂掉, quorum=1
         1. quorum 为 1 时, 只要有一个机器感知到master故障, 此时他自己就把自己选举为执行故障转移的哨兵
         2. 2 个哨兵的 majority 大多数为 2 , 但只有他自己现在在工作, 即不能被允许执行故障转移
         3. 3,4的 majority 是 2 , 5 的 majority 是 3

      2. quorum 解释
         1. quorum是用来识别故障的，真正执行故障转移的时候，还是要在哨兵集群执行选举，选举一个哨兵进程出来执行故障转移操作 
         2. 假设有5个哨兵，quorum设置了2，那么如果5个哨兵中的2个都认为master挂掉了; 2个哨兵中的一个就会做一个选举，选举一个哨兵出来，执行故障转移; 如果5个哨兵中有3个哨兵都是运行的，那么故障转移就会被允许执行